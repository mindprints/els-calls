<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Call Settings Dashboard</title>
    </head>
    <body>
        <h1>Call Settings Dashboard</h1>

        <form id="settings-form">
            <label for="mil_number">MIL Number:</label><br />
            <input type="text" id="mil_number" name="mil_number" /><br /><br />

            <label for="fallback_number">Fallback Number:</label><br />
            <input
                type="text"
                id="fallback_number"
                name="fallback_number"
            /><br /><br />

            <button type="submit">Save Settings</button>
        </form>

        <script>
            window.addEventListener("DOMContentLoaded", () => {
                const form = document.getElementById("settings-form");
                const milNumberInput = document.getElementById("mil_number");
                const fallbackNumberInput =
                    document.getElementById("fallback_number");

                // Load initial settings
                fetch("/settings")
                    .then((response) => response.json())
                    .then((data) => {
                        milNumberInput.value = data.MIL_NUMBER;
                        fallbackNumberInput.value = data.FALLBACK_NUMBER;
                    })
                    .catch((error) =>
                        console.error("Error loading settings:", error),
                    );

                // Handle form submission
                form.addEventListener("submit", (event) => {
                    event.preventDefault();

                    const newData = {
                        MIL_NUMBER: milNumberInput.value,
                        FALLBACK_NUMBER: fallbackNumberInput.value,
                    };

                    fetch("/settings", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify(newData),
                    })
                        .then((response) => response.json())
                        .then((data) => {
                            if (data.status === "success") {
                                alert("Settings saved successfully!");
                            } else {
                                alert("Error saving settings: " + data.message);
                            }
                        })
                        .catch((error) => {
                            console.error("Error saving settings:", error);
                            alert("Error saving settings.");
                        });
                });
            });
        </script>
    </body>
</html>
